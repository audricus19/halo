{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar _jsxFileName = \"/Volumes/Work/work/dev/project/projects/halo/app/javascript/src/marketplace/components/Sidebar/AffiliationEditModal.jsx\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { css, StyleSheet } from 'aphrodite';\nimport { Modal, Button, Dropdown } from 'semantic-ui-react';\nimport moment from 'moment';\nimport _, { debounce } from 'lodash';\nimport { COLORS } from '../../../../constants';\nimport { authenticityToken } from '../../utils/requests';\nvar styles = StyleSheet.create({\n  AffiliationEditModal_modal: {\n    overflow: 'visible'\n  },\n  AffiliationEditModal_modalHeader: {\n    fontWeight: 500,\n    fontSize: '24px',\n    lineHeight: '32px',\n    color: COLORS.lightBlack,\n    marginBottom: '32px'\n  },\n  AffiliationEditModal_modalFieldLabel: {\n    textAlign: 'left',\n    margin: '10px 0 6px',\n    width: '100%',\n    fontSize: '12px',\n    fontWeight: 500,\n    lineHeight: '16px',\n    color: COLORS.labelGray\n  },\n  AffiliationEditModal_modalTextInput: {\n    width: '100%',\n    margin: 'auto',\n    padding: '10px',\n    fontSize: '14px',\n    lineHeight: '20px',\n    borderStyle: 'solid',\n    borderWidth: '1px',\n    color: COLORS.lightBlack,\n    borderColor: COLORS.gray\n  },\n  AffiliationEditModal_modalSubmitButton: {\n    background: COLORS.lightBlue,\n    backgroundImage: 'linear-gradient(134.72deg, #4E9DF5 0%, #48B2F4 100%)',\n    display: 'inline-block',\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.white,\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px'\n  },\n  AffiliationEditModal_modalButtonHolder: {\n    width: '100%',\n    display: 'inline-block',\n    textAlign: 'right',\n    marginTop: '36px'\n  },\n  AffiliationEditModal_modalCancelButton: {\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.lightBlack,\n    backgroundColor: COLORS.white,\n    display: 'inline-block',\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px'\n  },\n  AffiliationEditModal_dropdown: {\n    width: '100%',\n    display: 'flex',\n    height: '48px',\n    alignItems: 'center',\n    borderStyle: 'solid',\n    borderWidth: '1px',\n    borderColor: COLORS.gray,\n    margin: 'auto',\n    fontSize: '14px'\n  }\n});\n\nvar yearOptions = _.range(new Date().getFullYear(), 1950, -1).map(function (year) {\n  return {\n    key: year,\n    text: year,\n    value: String(year)\n  };\n});\n\nvar AffiliationEditModal =\n/*#__PURE__*/\nfunction (_PureComponent) {\n  _inherits(AffiliationEditModal, _PureComponent);\n\n  function AffiliationEditModal(props) {\n    var _this;\n\n    _classCallCheck(this, AffiliationEditModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AffiliationEditModal).call(this, props));\n\n    _this.fetchUniversities = function _callee() {\n      var response, responseJson, universities;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.setState({\n                loadingUniversities: true\n              });\n\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(fetch('/universities', {\n                method: 'GET',\n                headers: {\n                  'Accept': 'application/json'\n                }\n              }));\n\n            case 3:\n              response = _context.sent;\n              _context.next = 6;\n              return _regeneratorRuntime.awrap(response.json());\n\n            case 6:\n              responseJson = _context.sent;\n              universities = responseJson.universities;\n\n              _this.setState({\n                universityOptions: universities,\n                loadingUniversities: false\n              });\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    };\n\n    _this.handleSubmitMessage = function _callee2(e) {\n      var _this$props, closeModal, currentUser, _this$state, location, locationStartYear, locationEndYear, profileInfo, formData, textResponse, responseJson;\n\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this$props = _this.props, closeModal = _this$props.closeModal, currentUser = _this$props.currentUser;\n              e.preventDefault();\n              _this$state = _this.state, location = _this$state.location, locationStartYear = _this$state.locationStartYear, locationEndYear = _this$state.locationEndYear;\n\n              _this.setState({\n                affiliationEditModalLoading: true\n              });\n\n              profileInfo = currentUser.profile_info || {};\n              formData = new FormData();\n              formData.append('location', location);\n\n              if (locationStartYear) {\n                formData.append('location_start_year', locationStartYear);\n              }\n\n              if (locationEndYear) {\n                formData.append('location_end_year', locationEndYear);\n              }\n\n              formData.append('user_id', currentUser.id);\n              _context2.prev = 10;\n              _context2.next = 13;\n              return _regeneratorRuntime.awrap(fetch(\"/user_profile_infos/\".concat(currentUser.id), {\n                method: 'PUT',\n                body: formData,\n                headers: {\n                  'Accept': 'application/json',\n                  'X-CSRF-Token': authenticityToken()\n                }\n              }));\n\n            case 13:\n              textResponse = _context2.sent;\n              _context2.next = 16;\n              return _regeneratorRuntime.awrap(textResponse.json());\n\n            case 16:\n              responseJson = _context2.sent;\n\n              if (!responseJson.success) {\n                _this.setState({\n                  affiliationEditModalLoading: false\n                });\n              } else {\n                _this.setState({\n                  affiliationEditModalLoading: false\n                });\n\n                window.location.reload();\n              }\n\n              _context2.next = 23;\n              break;\n\n            case 20:\n              _context2.prev = 20;\n              _context2.t0 = _context2[\"catch\"](10);\n\n              _this.setState({\n                affiliationEditModalLoading: false\n              });\n\n            case 23:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, [[10, 20]]);\n    };\n\n    _this.handleChange = function (e, attr) {\n      _this.setState(_defineProperty({}, attr, e.target.value));\n    };\n\n    _this.handleYears = function (e, selection, attr) {\n      _this.setState(_defineProperty({}, attr, selection.value));\n    };\n\n    _this.handleLocation = function (e, selection) {\n      _this.setState({\n        searchQuery: selection.value,\n        location: selection.value\n      });\n    };\n\n    _this.handleSearchQuery = function (options, query) {\n      var _this$state2 = _this.state,\n          universityOptions = _this$state2.universityOptions,\n          location = _this$state2.location;\n      return _.uniqBy([{\n        key: location,\n        text: location,\n        value: location\n      }].concat(universityOptions), 'key');\n    };\n\n    _this.universitySearch = debounce(function _callee3(name) {\n      var response, responseJson, universities;\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _this.setState({\n                loadingSearch: true\n              });\n\n              _context3.next = 3;\n              return _regeneratorRuntime.awrap(fetch(\"/universities/search?name=\".concat(name), {\n                method: 'GET',\n                headers: {\n                  'Accept': 'application/json'\n                }\n              }));\n\n            case 3:\n              response = _context3.sent;\n              _context3.next = 6;\n              return _regeneratorRuntime.awrap(response.json());\n\n            case 6:\n              responseJson = _context3.sent;\n              universities = responseJson.universities;\n\n              _this.setState({\n                location: '',\n                universityOptions: universities,\n                loadingSearch: false\n              });\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      });\n    }, 500, {\n      leading: true,\n      trailing: true\n    });\n\n    _this.handleSearchChange = function _callee4(e, _ref) {\n      var searchQuery;\n      return _regeneratorRuntime.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              searchQuery = _ref.searchQuery;\n\n              _this.universitySearch(searchQuery);\n\n              _this.setState({\n                searchQuery: searchQuery\n              });\n\n            case 3:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      });\n    };\n\n    var profileInfo = props.currentUser.profile_info || {};\n    _this.state = {\n      affiliationEditModalLoading: false,\n      loadingUniversities: false,\n      universityOptions: profileInfo.location ? [{\n        key: profileInfo.location,\n        value: profileInfo.location,\n        text: profileInfo.location\n      }] : [],\n      location: profileInfo.location,\n      locationStartYear: profileInfo.location_start_year,\n      locationEndYear: profileInfo.location_end_year,\n      loadingSearch: false,\n      searchQuery: profileInfo.location ? profileInfo.location : ''\n    };\n    return _this;\n  }\n\n  _createClass(AffiliationEditModal, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      return _regeneratorRuntime.async(function componentDidMount$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.currentUser !== this.props.currentUser) {\n        var profileInfo = this.props.currentUser.profile_info || {};\n        this.setState({\n          location: profileInfo.location,\n          locationStartYear: profileInfo.location_start_year,\n          locationEndYear: profileInfo.location_end_year\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props2 = this.props,\n          open = _this$props2.open,\n          proposal = _this$props2.proposal,\n          closeModal = _this$props2.closeModal;\n      var _this$state3 = this.state,\n          location = _this$state3.location,\n          locationStartYear = _this$state3.locationStartYear,\n          locationEndYear = _this$state3.locationEndYear,\n          loadingUniversities = _this$state3.loadingUniversities,\n          universityOptions = _this$state3.universityOptions,\n          affiliationEditModalLoading = _this$state3.affiliationEditModalLoading,\n          loadingSearch = _this$state3.loadingSearch,\n          searchQuery = _this$state3.searchQuery;\n      var validAffiliation = location && !loadingUniversities && !affiliationEditModalLoading;\n      return React.createElement(Modal, {\n        open: open,\n        onClose: closeModal,\n        size: \"small\",\n        closeOnDimmerClick: false,\n        className: \"\".concat(css(styles.AffiliationEditModal_modal), \" scrolling\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264\n        },\n        __self: this\n      }, React.createElement(Modal.Content, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: css(styles.AffiliationEditModal_modalHeader),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      }, location ? 'Affiliation' : 'Add Affiliation'), React.createElement(\"div\", {\n        className: css(styles.AffiliationEditModal_modalFieldLabel),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 275\n        },\n        __self: this\n      }, \"Place of Research\"), React.createElement(Dropdown, {\n        className: css(styles.AffiliationEditModal_dropdown),\n        placeholder: \"i.e. University, Research Institution, etc.\",\n        fluid: true,\n        icon: \"search\",\n        selection: true,\n        open: universityOptions.length > 0 && !location,\n        closeOnChange: true,\n        search: this.handleSearchQuery,\n        value: location || '',\n        options: universityOptions,\n        onChange: this.handleLocation,\n        searchQuery: searchQuery,\n        onSearchChange: this.handleSearchChange,\n        loading: loadingSearch,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 278\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        style: {\n          width: '48%',\n          marginRight: '4%',\n          display: 'inline-block'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: css(styles.AffiliationEditModal_modalFieldLabel),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 295\n        },\n        __self: this\n      }, \"Start Year\"), React.createElement(Dropdown, {\n        className: css(styles.AffiliationEditModal_dropdown),\n        icon: \"chevron down\",\n        fluid: true,\n        selection: true,\n        placeholder: \"Start Year\",\n        value: locationStartYear || '',\n        options: yearOptions,\n        onChange: function onChange(e, selection) {\n          return _this2.handleYears(e, selection, 'locationStartYear');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        style: {\n          width: '48%',\n          display: 'inline-block'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: css(styles.AffiliationEditModal_modalFieldLabel),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      }, \"End Year\"), React.createElement(Dropdown, {\n        className: css(styles.AffiliationEditModal_dropdown),\n        icon: \"chevron down\",\n        fluid: true,\n        selection: true,\n        placeholder: \"End Year\",\n        value: locationEndYear || '',\n        options: [{\n          key: 'Present',\n          text: 'Present',\n          value: 'Present'\n        }].concat(yearOptions),\n        onChange: function onChange(e, selection) {\n          return _this2.handleYears(e, selection, 'locationEndYear');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 313\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: css(styles.AffiliationEditModal_modalButtonHolder),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 324\n        },\n        __self: this\n      }, React.createElement(Button, {\n        className: css(styles.AffiliationEditModal_modalCancelButton),\n        type: \"submit\",\n        onClick: closeModal,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325\n        },\n        __self: this\n      }, \"Cancel\"), React.createElement(Button, {\n        className: css(styles.AffiliationEditModal_modalSubmitButton),\n        type: \"submit\",\n        disabled: !validAffiliation,\n        onClick: this.handleSubmitMessage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332\n        },\n        __self: this\n      }, \"Save\"))));\n    }\n  }]);\n\n  return AffiliationEditModal;\n}(PureComponent);\n\nAffiliationEditModal.propTypes = {\n  currentUser: PropTypes.object,\n  open: PropTypes.bool,\n  closeModal: PropTypes.func\n};\nexport default AffiliationEditModal;","map":{"version":3,"sources":["/Volumes/Work/work/dev/project/projects/halo/app/javascript/src/marketplace/components/Sidebar/AffiliationEditModal.jsx"],"names":["React","PureComponent","PropTypes","connect","css","StyleSheet","Modal","Button","Dropdown","moment","_","debounce","COLORS","authenticityToken","styles","create","AffiliationEditModal_modal","overflow","AffiliationEditModal_modalHeader","fontWeight","fontSize","lineHeight","color","lightBlack","marginBottom","AffiliationEditModal_modalFieldLabel","textAlign","margin","width","labelGray","AffiliationEditModal_modalTextInput","padding","borderStyle","borderWidth","borderColor","gray","AffiliationEditModal_modalSubmitButton","background","lightBlue","backgroundImage","display","height","white","AffiliationEditModal_modalButtonHolder","marginTop","AffiliationEditModal_modalCancelButton","backgroundColor","AffiliationEditModal_dropdown","alignItems","yearOptions","range","Date","getFullYear","map","year","key","text","value","String","AffiliationEditModal","props","fetchUniversities","setState","loadingUniversities","fetch","method","headers","response","json","responseJson","universities","universityOptions","handleSubmitMessage","e","closeModal","currentUser","preventDefault","state","location","locationStartYear","locationEndYear","affiliationEditModalLoading","profileInfo","profile_info","formData","FormData","append","id","body","textResponse","success","window","reload","handleChange","attr","target","handleYears","selection","handleLocation","searchQuery","handleSearchQuery","options","query","uniqBy","concat","universitySearch","name","loadingSearch","leading","trailing","handleSearchChange","location_start_year","location_end_year","prevProps","open","proposal","validAffiliation","length","marginRight","propTypes","object","bool","func"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { css, StyleSheet } from 'aphrodite';\nimport { Modal, Button, Dropdown } from 'semantic-ui-react';\nimport moment from 'moment';\nimport _, { debounce } from 'lodash';\nimport { COLORS } from '../../../../constants';\nimport {\n  authenticityToken,\n} from '../../utils/requests';\n\nconst styles = StyleSheet.create({\n  AffiliationEditModal_modal: {\n    overflow: 'visible',\n  },\n  AffiliationEditModal_modalHeader: {\n    fontWeight: 500,\n    fontSize: '24px',\n    lineHeight: '32px',\n    color: COLORS.lightBlack,\n    marginBottom: '32px',\n  },\n  AffiliationEditModal_modalFieldLabel: {\n    textAlign: 'left',\n    margin: '10px 0 6px',\n    width: '100%',\n    fontSize: '12px',\n    fontWeight: 500,\n    lineHeight: '16px',\n    color: COLORS.labelGray,\n  },\n  AffiliationEditModal_modalTextInput: {\n    width: '100%',\n    margin: 'auto',\n    padding: '10px',\n    fontSize: '14px',\n    lineHeight: '20px',\n    borderStyle: 'solid',\n    borderWidth: '1px',\n    color: COLORS.lightBlack,\n    borderColor: COLORS.gray,\n  },\n  AffiliationEditModal_modalSubmitButton: {\n    background: COLORS.lightBlue,\n    backgroundImage: 'linear-gradient(134.72deg, #4E9DF5 0%, #48B2F4 100%)',\n    display: 'inline-block',\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.white,\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px',\n  },\n  AffiliationEditModal_modalButtonHolder: {\n    width: '100%',\n    display: 'inline-block',\n    textAlign: 'right',\n    marginTop: '36px',\n  },\n  AffiliationEditModal_modalCancelButton: {\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.lightBlack,\n    backgroundColor: COLORS.white,\n    display: 'inline-block',\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px',\n  },\n  AffiliationEditModal_dropdown: {\n    width: '100%',\n    display: 'flex',\n    height: '48px',\n    alignItems: 'center',\n    borderStyle: 'solid',\n    borderWidth: '1px',\n    borderColor: COLORS.gray,\n    margin: 'auto',\n    fontSize: '14px',\n  },\n});\n\nconst yearOptions = _.range(new Date().getFullYear(), 1950, -1).map((year) => {\n  return {\n    key: year,\n    text: year,\n    value: String(year),\n  };\n});\n\nclass AffiliationEditModal extends PureComponent {\n  constructor(props) {\n    super(props);\n    const profileInfo = props.currentUser.profile_info || {};\n    this.state = {\n      affiliationEditModalLoading: false,\n      loadingUniversities: false,\n      universityOptions: profileInfo.location ? [{ key: profileInfo.location, value: profileInfo.location, text: profileInfo.location }] : [],\n      location: profileInfo.location,\n      locationStartYear: profileInfo.location_start_year,\n      locationEndYear: profileInfo.location_end_year,\n      loadingSearch: false,\n      searchQuery: profileInfo.location ? profileInfo.location : '',\n    };\n  }\n\n  async componentDidMount() {\n    // await this.fetchUniversities();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.currentUser !== this.props.currentUser) {\n      const profileInfo = this.props.currentUser.profile_info || {};\n      this.setState({\n        location: profileInfo.location,\n        locationStartYear: profileInfo.location_start_year,\n        locationEndYear: profileInfo.location_end_year,\n      });\n    }\n  }\n\n  fetchUniversities = async () => {\n    this.setState({ loadingUniversities: true });\n    const response = await fetch('/universities', {\n      method: 'GET',\n      headers: {\n        'Accept': 'application/json',\n      }\n    });\n    const responseJson = await response.json();\n    const universities = responseJson.universities;\n\n    this.setState({\n      universityOptions: universities,\n      loadingUniversities: false,\n    });\n  }\n\n  handleSubmitMessage = async (e) => {\n    const {\n      closeModal,\n      currentUser,\n    } = this.props;\n\n    e.preventDefault();\n\n    const {\n      location,\n      locationStartYear,\n      locationEndYear,\n    } = this.state;\n\n    this.setState({\n      affiliationEditModalLoading: true,\n    });\n\n    const profileInfo = currentUser.profile_info || {};\n\n    const formData = new FormData();\n    formData.append('location', location);\n    if (locationStartYear) {\n      formData.append('location_start_year', locationStartYear);\n    }\n    if (locationEndYear) {\n      formData.append('location_end_year', locationEndYear);\n    }\n\n    formData.append('user_id', currentUser.id);\n\n    try {\n      const textResponse = await fetch(`/user_profile_infos/${currentUser.id}`, {\n        method: 'PUT',\n        body: formData,\n        headers: {\n          'Accept': 'application/json',\n          'X-CSRF-Token': authenticityToken(),\n        }\n      });\n      const responseJson = await textResponse.json();\n      if (!responseJson.success) {\n        this.setState({\n          affiliationEditModalLoading: false,\n        });\n      } else {\n        this.setState({\n          affiliationEditModalLoading: false,\n        });\n        window.location.reload();\n      }\n    } catch(err) {\n      this.setState({ affiliationEditModalLoading: false });\n    }\n  }\n\n  handleChange = (e, attr) => {\n    this.setState({ [attr]: e.target.value });\n  };\n\n  handleYears = (e, selection, attr) => {\n    this.setState({ [attr]: selection.value });\n  };\n\n  handleLocation = (e, selection) => {\n    this.setState({\n      searchQuery: selection.value,\n      location: selection.value,\n    });\n  };\n\n  handleSearchQuery = (options, query) => {\n    const { universityOptions, location } = this.state;\n    return _.uniqBy([{ key: location, text: location, value: location }].concat(universityOptions), 'key');\n  }\n\n  universitySearch = debounce(async (name) => {\n    this.setState({ loadingSearch: true });\n    const response = await fetch(`/universities/search?name=${name}`, {\n      method: 'GET',\n      headers: {\n        'Accept': 'application/json',\n      }\n    });\n    const responseJson = await response.json();\n    const universities = responseJson.universities;\n\n    this.setState({\n      location: '',\n      universityOptions: universities,\n      loadingSearch: false,\n    });\n  }, 500, { leading: true, trailing: true });\n\n  handleSearchChange = async (e, { searchQuery }) => {\n    this.universitySearch(searchQuery);\n\n    this.setState({\n      searchQuery,\n    });\n  };\n\n  render() {\n    const {\n      open,\n      proposal,\n      closeModal,\n    } = this.props;\n\n    const {\n      location,\n      locationStartYear,\n      locationEndYear,\n      loadingUniversities,\n      universityOptions,\n      affiliationEditModalLoading,\n      loadingSearch,\n      searchQuery,\n    } = this.state;\n\n    const validAffiliation = location && !loadingUniversities && !affiliationEditModalLoading;\n    return (\n      <Modal\n        open={open}\n        onClose={closeModal}\n        size=\"small\"\n        closeOnDimmerClick={false}\n        className={`${css(styles.AffiliationEditModal_modal)} scrolling`}\n      >\n        <Modal.Content>\n          <div className={css(styles.AffiliationEditModal_modalHeader)}>\n            {location ? 'Affiliation' : 'Add Affiliation'}\n          </div>\n          <div className={css(styles.AffiliationEditModal_modalFieldLabel)}>\n            Place of Research\n          </div>\n          <Dropdown\n            className={css(styles.AffiliationEditModal_dropdown)}\n            placeholder='i.e. University, Research Institution, etc.'\n            fluid\n            icon='search'\n            selection\n            open={universityOptions.length > 0 && !location}\n            closeOnChange\n            search={this.handleSearchQuery}\n            value={location || ''}\n            options={universityOptions}\n            onChange={this.handleLocation}\n            searchQuery={searchQuery}\n            onSearchChange={this.handleSearchChange}\n            loading={loadingSearch}\n          />\n          <div style={{ width: '48%', marginRight: '4%', display: 'inline-block' }}>\n            <div className={css(styles.AffiliationEditModal_modalFieldLabel)}>\n              Start Year\n            </div>\n            <Dropdown\n              className={css(styles.AffiliationEditModal_dropdown)}\n              icon=\"chevron down\"\n              fluid\n              selection\n              placeholder=\"Start Year\"\n              value={locationStartYear || ''}\n              options={yearOptions}\n              onChange={(e, selection) => this.handleYears(e, selection, 'locationStartYear')}\n            />\n          </div>\n          <div style={{ width: '48%', display: 'inline-block' }}>\n            <div className={css(styles.AffiliationEditModal_modalFieldLabel)}>\n              End Year\n            </div>\n            <Dropdown\n              className={css(styles.AffiliationEditModal_dropdown)}\n              icon=\"chevron down\"\n              fluid\n              selection\n              placeholder=\"End Year\"\n              value={locationEndYear || ''}\n              options={[{ key: 'Present', text: 'Present', value: 'Present'}].concat(yearOptions)}\n              onChange={(e, selection) => this.handleYears(e, selection, 'locationEndYear')}\n            />\n          </div>\n          <div className={css(styles.AffiliationEditModal_modalButtonHolder)}>\n            <Button\n              className={css(styles.AffiliationEditModal_modalCancelButton)}\n              type='submit'\n              onClick={closeModal}\n            >\n              Cancel\n            </Button>\n            <Button\n              className={css(styles.AffiliationEditModal_modalSubmitButton)}\n              type='submit'\n              disabled={!validAffiliation}\n              onClick={this.handleSubmitMessage}\n            >\n              Save\n            </Button>\n          </div>\n        </Modal.Content>\n      </Modal>\n    );\n  }\n}\n\nAffiliationEditModal.propTypes = {\n  currentUser: PropTypes.object,\n  open: PropTypes.bool,\n  closeModal: PropTypes.func,\n};\n\nexport default AffiliationEditModal;\n"]},"metadata":{},"sourceType":"module"}
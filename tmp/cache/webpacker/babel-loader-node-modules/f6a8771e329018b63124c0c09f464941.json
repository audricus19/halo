{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar _jsxFileName = \"/Volumes/Work/work/dev/project/projects/halo/app/javascript/src/marketplace/components/ProposalsDashboard/ContactModal.jsx\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { css, StyleSheet } from 'aphrodite';\nimport { Modal, Button, Dropdown, Icon } from 'semantic-ui-react';\nimport _ from 'lodash';\nimport { COLORS, PROPOSAL_STATUSES } from '../../../../constants';\nimport { authenticityToken } from '../../utils/requests';\nvar styles = StyleSheet.create({\n  ContactModal_modal: {},\n  ContactModal_modalFieldLabel: {\n    textAlign: 'left',\n    margin: '10px 0 6px',\n    width: '100%',\n    fontSize: '12px',\n    fontWeight: 500,\n    lineHeight: '16px',\n    color: COLORS.labelGray\n  },\n  ContactModal_modalTextArea: {\n    width: '100%',\n    margin: 'auto',\n    padding: '10px',\n    fontSize: '14px',\n    lineHeight: '20px'\n  },\n  ContactModal_modalSubmitButton: {\n    background: COLORS.lightBlue,\n    backgroundImage: 'linear-gradient(134.72deg, #4E9DF5 0%, #48B2F4 100%)',\n    display: 'inline-block',\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.white,\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px'\n  },\n  ContactModal_modalButtonHolder: {\n    width: '100%',\n    display: 'inline-block',\n    textAlign: 'right',\n    marginTop: '36px'\n  },\n  ContactModal_modalCancelButton: {\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.lightBlack,\n    backgroundColor: COLORS.white,\n    display: 'inline-block',\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px'\n  },\n  ContactModal_title: {\n    fontSize: '24px'\n  },\n  ContactModal_dropdown: {\n    width: '50%',\n    display: 'flex',\n    height: '48px',\n    alignItems: 'center',\n    lineHeight: '20px',\n    borderStyle: 'solid',\n    borderWidth: '1px',\n    borderColor: COLORS.gray,\n    marginBottom: '20px',\n    fontSize: '14px'\n  }\n});\n\nvar ContactModal =\n/*#__PURE__*/\nfunction (_PureComponent) {\n  _inherits(ContactModal, _PureComponent);\n\n  function ContactModal(props) {\n    var _this;\n\n    _classCallCheck(this, ContactModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ContactModal).call(this, props));\n\n    _this.componentDidUpdate = function _callee(prevProps) {\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(prevProps.status !== _this.props.status && _this.props.status === PROPOSAL_STATUSES.DECLINED)) {\n                _context.next = 3;\n                break;\n              }\n\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(_this.fetchEmailResponseTemplates());\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    };\n\n    _this.fetchEmailResponseTemplates = function _callee2() {\n      var emailTemplateResponse, responseJson;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(fetch(\"/email_response_templates?user_id=\".concat(gon.current_user.id), {\n                method: 'GET',\n                headers: {\n                  'Accept': 'application/json'\n                }\n              }));\n\n            case 2:\n              emailTemplateResponse = _context2.sent;\n              _context2.next = 5;\n              return _regeneratorRuntime.awrap(emailTemplateResponse.json());\n\n            case 5:\n              responseJson = _context2.sent;\n\n              _this.setState({\n                emailResponseTemplates: responseJson.email_response_templates,\n                emailResponseTemplateOptions: responseJson.email_response_templates.map(function (emailResponse) {\n                  return {\n                    key: emailResponse.id,\n                    text: emailResponse.title,\n                    value: emailResponse.id\n                  };\n                })\n              });\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      });\n    };\n\n    _this.handleSaveResponse = function _callee3(e) {\n      var _this$state, message, title, formData, saveTemplateResponse, responseJson;\n\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              e.preventDefault();\n              _this$state = _this.state, message = _this$state.message, title = _this$state.title;\n\n              _this.setState({\n                contactModalLoading: true\n              });\n\n              formData = new FormData();\n              formData.append('content', message);\n              formData.append('title', title);\n              _context3.prev = 6;\n              _context3.next = 9;\n              return _regeneratorRuntime.awrap(fetch('/email_response_templates', {\n                method: 'POST',\n                body: formData,\n                headers: {\n                  'Accept': 'application/json',\n                  'X-CSRF-Token': authenticityToken()\n                }\n              }));\n\n            case 9:\n              saveTemplateResponse = _context3.sent;\n              _context3.next = 12;\n              return _regeneratorRuntime.awrap(saveTemplateResponse.json());\n\n            case 12:\n              responseJson = _context3.sent;\n              _context3.next = 18;\n              break;\n\n            case 15:\n              _context3.prev = 15;\n              _context3.t0 = _context3[\"catch\"](6);\n\n              _this.setState({\n                contactModalLoading: false\n              });\n\n            case 18:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, [[6, 15]]);\n    };\n\n    _this.handleSubmitMessage = function _callee4(e) {\n      var _this$props, closeContactModal, proposal, status, fetchProposals, message, formData, messageResponse, responseJson;\n\n      return _regeneratorRuntime.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _this$props = _this.props, closeContactModal = _this$props.closeContactModal, proposal = _this$props.proposal, status = _this$props.status, fetchProposals = _this$props.fetchProposals;\n              e.preventDefault();\n              message = _this.state.message;\n\n              _this.setState({\n                contactModalLoading: true\n              });\n\n              formData = new FormData();\n              formData.append('message', message);\n              formData.append('proposal_id', proposal.id);\n              formData.append('status', status);\n              _context4.prev = 8;\n              _context4.next = 11;\n              return _regeneratorRuntime.awrap(fetch('/messages/proposal_contact', {\n                method: 'POST',\n                body: formData,\n                headers: {\n                  'Accept': 'application/json',\n                  'X-CSRF-Token': authenticityToken()\n                }\n              }));\n\n            case 11:\n              messageResponse = _context4.sent;\n              _context4.next = 14;\n              return _regeneratorRuntime.awrap(messageResponse.json());\n\n            case 14:\n              responseJson = _context4.sent;\n\n              if (responseJson.success) {\n                _context4.next = 19;\n                break;\n              }\n\n              _this.setState({\n                contactModalLoading: false\n              });\n\n              _context4.next = 23;\n              break;\n\n            case 19:\n              _context4.next = 21;\n              return _regeneratorRuntime.awrap(fetchProposals(proposal.request_for_proposal_id));\n\n            case 21:\n              _this.setState({\n                message: '',\n                contactModalLoading: false\n              });\n\n              window.location.reload();\n\n            case 23:\n              _context4.next = 28;\n              break;\n\n            case 25:\n              _context4.prev = 25;\n              _context4.t0 = _context4[\"catch\"](8);\n\n              _this.setState({\n                contactModalLoading: false\n              });\n\n            case 28:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, [[8, 25]]);\n    };\n\n    _this.handleChange = function (e, attr) {\n      _this.setState(_defineProperty({}, attr, e.target.value));\n    };\n\n    _this.handleSelectEmailTemplate = function (e, selection) {\n      var proposal = _this.props.proposal;\n      var emailResponseTemplates = _this.state.emailResponseTemplates;\n\n      var selectedTemplate = _.find(emailResponseTemplates, function (template) {\n        return Number(template.id) === Number(selection.value);\n      });\n\n      _this.setState({\n        emailTemplate: selectedTemplate,\n        message: \"Hi \".concat(proposal.user.first_name, \",\\n\\n\").concat(selectedTemplate.content, \"\\n\\nThank you,\\n\").concat(gon.current_user.first_name)\n      });\n    };\n\n    _this.state = {\n      contactModalLoading: false,\n      message: '',\n      title: '',\n      emailTemplate: {},\n      emailResponseTemplates: [],\n      emailResponseTemplateOptions: []\n    };\n    return _this;\n  }\n\n  _createClass(ContactModal, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props2 = this.props,\n          open = _this$props2.open,\n          proposal = _this$props2.proposal,\n          closeContactModal = _this$props2.closeContactModal,\n          status = _this$props2.status;\n      var _this$state2 = this.state,\n          message = _this$state2.message,\n          emailTemplate = _this$state2.emailTemplate,\n          emailResponseTemplates = _this$state2.emailResponseTemplates,\n          emailResponseTemplateOptions = _this$state2.emailResponseTemplateOptions;\n      var validMessage = !!!message;\n      return React.createElement(Modal, {\n        open: open,\n        onClose: closeContactModal,\n        size: \"small\",\n        closeOnDimmerClick: false,\n        className: \"\".concat(css(styles.ContactModal_modal), \" scrolling\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, React.createElement(Modal.Content, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, status === PROPOSAL_STATUSES.DECLINED ? React.createElement(\"h4\", {\n        className: css(styles.ContactModal_title),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, \"Decline Message\") : React.createElement(\"h4\", {\n        className: css(styles.ContactModal_title),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, \"Message\"), proposal && React.createElement(\"div\", {\n        style: {\n          fontSize: '12px'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, React.createElement(\"b\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, \"To:\"), \" \", proposal.user.first_name, \" \", proposal.user.last_name), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      }), status === PROPOSAL_STATUSES.DECLINED && React.createElement(React.Fragment, null, React.createElement(\"div\", {\n        className: css(styles.ContactModal_modalFieldLabel),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      }, \"Decline reason\"), React.createElement(Dropdown, {\n        className: css(styles.ContactModal_dropdown),\n        icon: \"chevron down\",\n        fluid: true,\n        selection: true,\n        placeholder: \"Choose a saved template\",\n        value: emailTemplate.id,\n        options: emailResponseTemplateOptions,\n        onChange: this.handleSelectEmailTemplate,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }, React.createElement(\"textarea\", {\n        className: css(styles.ContactModal_modalTextArea),\n        rows: \"4\",\n        value: message,\n        onChange: function onChange(e) {\n          return _this2.handleChange(e, 'message');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: css(styles.ContactModal_modalButtonHolder),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268\n        },\n        __self: this\n      }, React.createElement(Button, {\n        className: css(styles.ContactModal_modalCancelButton),\n        type: \"submit\",\n        onClick: closeContactModal,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }, \"Cancel\"), React.createElement(Button, {\n        className: css(styles.ContactModal_modalSubmitButton),\n        type: \"submit\",\n        disabled: validMessage,\n        onClick: this.handleSubmitMessage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 276\n        },\n        __self: this\n      }, \"Send Email\"))));\n    }\n  }]);\n\n  return ContactModal;\n}(PureComponent);\n\nContactModal.propTypes = {\n  proposal: PropTypes.object,\n  open: PropTypes.bool,\n  closeContactModal: PropTypes.func\n};\nexport default ContactModal;","map":{"version":3,"sources":["/Volumes/Work/work/dev/project/projects/halo/app/javascript/src/marketplace/components/ProposalsDashboard/ContactModal.jsx"],"names":["React","PureComponent","PropTypes","connect","css","StyleSheet","Modal","Button","Dropdown","Icon","_","COLORS","PROPOSAL_STATUSES","authenticityToken","styles","create","ContactModal_modal","ContactModal_modalFieldLabel","textAlign","margin","width","fontSize","fontWeight","lineHeight","color","labelGray","ContactModal_modalTextArea","padding","ContactModal_modalSubmitButton","background","lightBlue","backgroundImage","display","height","white","ContactModal_modalButtonHolder","marginTop","ContactModal_modalCancelButton","lightBlack","backgroundColor","ContactModal_title","ContactModal_dropdown","alignItems","borderStyle","borderWidth","borderColor","gray","marginBottom","ContactModal","props","componentDidUpdate","prevProps","status","DECLINED","fetchEmailResponseTemplates","fetch","gon","current_user","id","method","headers","emailTemplateResponse","json","responseJson","setState","emailResponseTemplates","email_response_templates","emailResponseTemplateOptions","map","emailResponse","key","text","title","value","handleSaveResponse","e","preventDefault","state","message","contactModalLoading","formData","FormData","append","body","saveTemplateResponse","handleSubmitMessage","closeContactModal","proposal","fetchProposals","messageResponse","success","request_for_proposal_id","window","location","reload","handleChange","attr","target","handleSelectEmailTemplate","selection","selectedTemplate","find","template","Number","emailTemplate","user","first_name","content","open","validMessage","last_name","propTypes","object","bool","func"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { css, StyleSheet } from 'aphrodite';\nimport { Modal, Button, Dropdown, Icon } from 'semantic-ui-react';\nimport _ from 'lodash';\nimport { COLORS, PROPOSAL_STATUSES } from '../../../../constants';\nimport {\n  authenticityToken,\n} from '../../utils/requests';\n\nconst styles = StyleSheet.create({\n  ContactModal_modal: {\n\n  },\n  ContactModal_modalFieldLabel: {\n    textAlign: 'left',\n    margin: '10px 0 6px',\n    width: '100%',\n    fontSize: '12px',\n    fontWeight: 500,\n    lineHeight: '16px',\n    color: COLORS.labelGray,\n  },\n  ContactModal_modalTextArea: {\n    width: '100%',\n    margin: 'auto',\n    padding: '10px',\n    fontSize: '14px',\n    lineHeight: '20px',\n  },\n  ContactModal_modalSubmitButton: {\n    background: COLORS.lightBlue,\n    backgroundImage: 'linear-gradient(134.72deg, #4E9DF5 0%, #48B2F4 100%)',\n    display: 'inline-block',\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.white,\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px',\n  },\n  ContactModal_modalButtonHolder: {\n    width: '100%',\n    display: 'inline-block',\n    textAlign: 'right',\n    marginTop: '36px',\n  },\n  ContactModal_modalCancelButton: {\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.lightBlack,\n    backgroundColor: COLORS.white,\n    display: 'inline-block',\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px',\n  },\n  ContactModal_title: {\n    fontSize: '24px',\n  },\n  ContactModal_dropdown: {\n    width: '50%',\n    display: 'flex',\n    height: '48px',\n    alignItems: 'center',\n    lineHeight: '20px',\n    borderStyle: 'solid',\n    borderWidth: '1px',\n    borderColor: COLORS.gray,\n    marginBottom: '20px',\n    fontSize: '14px',\n  },\n});\n\nclass ContactModal extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      contactModalLoading: false,\n      message: '',\n      title: '',\n      emailTemplate: {},\n      emailResponseTemplates: [],\n      emailResponseTemplateOptions: [],\n    };\n  }\n\n  componentDidUpdate = async (prevProps) => {\n    if (prevProps.status !== this.props.status && this.props.status === PROPOSAL_STATUSES.DECLINED) {\n      await this.fetchEmailResponseTemplates();\n    }\n  }\n\n  fetchEmailResponseTemplates = async () => {\n    const emailTemplateResponse = await fetch(`/email_response_templates?user_id=${gon.current_user.id}`, {\n      method: 'GET',\n      headers: {\n        'Accept': 'application/json',\n      },\n    });\n    const responseJson = await emailTemplateResponse.json();\n\n    this.setState({\n      emailResponseTemplates: responseJson.email_response_templates,\n      emailResponseTemplateOptions: responseJson.email_response_templates.map(emailResponse => (\n        {\n          key: emailResponse.id,\n          text: emailResponse.title,\n          value: emailResponse.id,\n        }\n      )),\n    });\n  };\n\n  handleSaveResponse = async (e) => {\n    e.preventDefault();\n\n    const {\n      message,\n      title,\n    } = this.state;\n\n    this.setState({\n      contactModalLoading: true,\n    });\n\n    const formData = new FormData();\n\n    formData.append('content', message);\n    formData.append('title', title);\n\n    try {\n      const saveTemplateResponse = await fetch('/email_response_templates', {\n        method: 'POST',\n        body: formData,\n        headers: {\n          'Accept': 'application/json',\n          'X-CSRF-Token': authenticityToken(),\n        }\n      });\n      const responseJson = await saveTemplateResponse.json();\n\n    } catch(err) {\n      this.setState({ contactModalLoading: false });\n    }\n  }\n\n  handleSubmitMessage = async (e) => {\n    const {\n      closeContactModal,\n      proposal,\n      status,\n      fetchProposals,\n    } = this.props;\n\n    e.preventDefault();\n\n    const {\n      message,\n    } = this.state;\n\n    this.setState({\n      contactModalLoading: true,\n    });\n\n    const formData = new FormData();\n    formData.append('message', message);\n    formData.append('proposal_id', proposal.id);\n    formData.append('status', status);\n\n    try {\n      const messageResponse = await fetch('/messages/proposal_contact', {\n        method: 'POST',\n        body: formData,\n        headers: {\n          'Accept': 'application/json',\n          'X-CSRF-Token': authenticityToken(),\n        }\n      });\n      const responseJson = await messageResponse.json();\n      if (!responseJson.success) {\n        this.setState({\n          contactModalLoading: false,\n        });\n      } else {\n        await fetchProposals(proposal.request_for_proposal_id);\n        this.setState({\n          message: '',\n          contactModalLoading: false,\n        });\n        window.location.reload();\n      }\n    } catch(err) {\n      this.setState({ contactModalLoading: false });\n    }\n  }\n\n  handleChange = (e, attr) => {\n    this.setState({ [attr]: e.target.value });\n  };\n\n  handleSelectEmailTemplate = (e, selection) => {\n    const { proposal } = this.props;\n    const { emailResponseTemplates } = this.state;\n    const selectedTemplate = _.find(emailResponseTemplates, (template) => {\n      return Number(template.id) === Number(selection.value);\n    });\n    this.setState({\n      emailTemplate: selectedTemplate,\n      message: `Hi ${proposal.user.first_name},\\n\\n${selectedTemplate.content}\\n\\nThank you,\\n${gon.current_user.first_name}`,\n    });\n  }\n\n  render() {\n    const {\n      open,\n      proposal,\n      closeContactModal,\n      status,\n    } = this.props;\n\n    const {\n      message,\n      emailTemplate,\n      emailResponseTemplates,\n      emailResponseTemplateOptions,\n    } = this.state;\n\n    const validMessage = !!!message;\n    return (\n      <Modal\n        open={open}\n        onClose={closeContactModal}\n        size=\"small\"\n        closeOnDimmerClick={false}\n        className={`${css(styles.ContactModal_modal)} scrolling`}\n      >\n        <Modal.Content>\n          {status === PROPOSAL_STATUSES.DECLINED ? <h4 className={css(styles.ContactModal_title)}>Decline Message</h4> : <h4 className={css(styles.ContactModal_title)}>Message</h4>}\n          {proposal && <div style={{ fontSize: '12px' }}><b>To:</b> {proposal.user.first_name} {proposal.user.last_name}</div>}\n          <br />\n          {status === PROPOSAL_STATUSES.DECLINED &&\n            <>\n              <div className={css(styles.ContactModal_modalFieldLabel)}>Decline reason</div>\n              <Dropdown\n                className={css(styles.ContactModal_dropdown)}\n                icon=\"chevron down\"\n                fluid\n                selection\n                placeholder=\"Choose a saved template\"\n                value={emailTemplate.id}\n                options={emailResponseTemplateOptions}\n                onChange={this.handleSelectEmailTemplate}\n              />\n            </>\n          }\n          <div>\n            <textarea\n              className={css(styles.ContactModal_modalTextArea)}\n              rows=\"4\"\n              value={message}\n              onChange={(e) => this.handleChange(e, 'message')}\n            />\n          </div>\n          <div className={css(styles.ContactModal_modalButtonHolder)}>\n            <Button\n              className={css(styles.ContactModal_modalCancelButton)}\n              type='submit'\n              onClick={closeContactModal}\n            >\n              Cancel\n            </Button>\n            <Button\n              className={css(styles.ContactModal_modalSubmitButton)}\n              type='submit'\n              disabled={validMessage}\n              onClick={this.handleSubmitMessage}\n            >\n              Send Email\n            </Button>\n          </div>\n        </Modal.Content>\n      </Modal>\n    );\n  }\n}\n\nContactModal.propTypes = {\n  proposal: PropTypes.object,\n  open: PropTypes.bool,\n  closeContactModal: PropTypes.func,\n};\n\nexport default ContactModal;\n"]},"metadata":{},"sourceType":"module"}
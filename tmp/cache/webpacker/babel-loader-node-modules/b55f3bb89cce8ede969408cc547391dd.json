{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar _jsxFileName = \"/Volumes/Work/work/dev/project/projects/halo/app/javascript/src/marketplace/components/NewPublicationModal/NewPublicationModal.jsx\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { css, StyleSheet } from 'aphrodite';\nimport { Modal, Button, Dropdown, Icon } from 'semantic-ui-react';\nimport _ from 'lodash';\nimport DatePicker from 'react-datepicker';\nimport moment from 'moment';\nimport { styles as modalStyles } from '../Modal';\nimport { COLORS } from '../../../../constants';\nimport { fetchPublications as fetchPublicationsAction, togglePublicationModal as togglePublicationModalAction } from '../../actions/profileActions';\nimport { authenticityToken } from '../../utils/requests';\nvar styles = StyleSheet.create({\n  NewPublicationModal_modal: {\n    overflow: 'visible'\n  },\n  NewPublicationModal_dateDropdown: {\n    width: '48%',\n    height: '48px',\n    fontSize: '14px',\n    display: 'inline-block',\n    alignItems: 'center',\n    borderRadius: '0px',\n    paddingTop: '16px',\n    color: COLORS.defaultText,\n    border: \"1px solid \".concat(COLORS.defaultText)\n  },\n  NewPublicationModal_modalFieldLabel: {\n    textAlign: 'left',\n    margin: '10px 0 6px',\n    width: '100%',\n    fontSize: '12px',\n    fontWeight: 500,\n    lineHeight: '16px',\n    color: COLORS.labelGray\n  },\n  NewPublicationModal_modalInput: {\n    width: '100%',\n    margin: 'auto',\n    padding: '10px',\n    height: '50px',\n    fontSize: '14px',\n    lineHeight: '20px',\n    borderStyle: 'solid',\n    borderWidth: '1px'\n  },\n  NewPublicationModal_modalHeader: {\n    fontWeight: 500,\n    fontSize: '24px',\n    lineHeight: '32px',\n    color: COLORS.lightBlack,\n    marginBottom: '32px'\n  },\n  NewPublicationModal_modalTextArea: {\n    width: '100%',\n    margin: 'auto',\n    padding: '10px',\n    fontSize: '14px',\n    lineHeight: '20px'\n  },\n  NewPublicationModal_datepicker: {\n    width: '100%',\n    height: '50px',\n    padding: '10px',\n    borderStyle: 'solid',\n    borderWidth: '1px',\n    fontSize: '14px'\n  },\n  NewPublicationModal_modalSubmitButton: {\n    background: COLORS.lightBlue,\n    backgroundImage: 'linear-gradient(134.72deg, #4E9DF5 0%, #48B2F4 100%)',\n    display: 'inline-block',\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.white,\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px'\n  },\n  NewPublicationModal_modalButtonHolder: {\n    width: '100%',\n    display: 'inline-block',\n    textAlign: 'right',\n    marginTop: '36px'\n  },\n  NewPublicationModal_modalCancelButton: {\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.lightBlack,\n    backgroundColor: COLORS.white,\n    display: 'inline-block',\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px'\n  }\n});\n\nvar yearOptions = _.range(new Date().getFullYear(), 1950, -1).map(function (year) {\n  return {\n    key: year,\n    text: year,\n    value: String(year)\n  };\n});\n\nmoment.locale('en');\nvar monthOptions = moment.monthsShort('-MMM-').map(function (month, index) {\n  return {\n    key: month,\n    text: month,\n    value: String(index + 1)\n  };\n});\n\nvar NewPublicationModal =\n/*#__PURE__*/\nfunction (_PureComponent) {\n  _inherits(NewPublicationModal, _PureComponent);\n\n  function NewPublicationModal(props) {\n    var _this;\n\n    _classCallCheck(this, NewPublicationModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(NewPublicationModal).call(this, props));\n\n    _this.handleSubmitPublication = function _callee(e) {\n      var _this$props, fetchPublications, togglePublicationModal, currentUserId, currentPublicationId, clearUrl, afterAddAction, inEditMode, _this$state, publicationTitle, publicationName, publicationAbstract, publicationMonth, publicationYear, publicationURL, formData, publicationDate, url, publicationResponse, responseJson;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$props = _this.props, fetchPublications = _this$props.fetchPublications, togglePublicationModal = _this$props.togglePublicationModal, currentUserId = _this$props.currentUserId, currentPublicationId = _this$props.currentPublicationId, clearUrl = _this$props.clearUrl, afterAddAction = _this$props.afterAddAction, inEditMode = _this$props.inEditMode;\n              e.preventDefault();\n              _this$state = _this.state, publicationTitle = _this$state.publicationTitle, publicationName = _this$state.publicationName, publicationAbstract = _this$state.publicationAbstract, publicationMonth = _this$state.publicationMonth, publicationYear = _this$state.publicationYear, publicationURL = _this$state.publicationURL;\n\n              _this.setState({\n                publicationModalLoading: true\n              });\n\n              formData = new FormData();\n              formData.append('publication[publicationTitle]', publicationTitle);\n              formData.append('publication[publicationName]', publicationName);\n              formData.append('publication[publicationAbstract]', publicationAbstract);\n              formData.append('publication[publicationURL]', encodeURI(publicationURL));\n\n              if (publicationYear) {\n                publicationDate = \"\".concat(publicationYear, \"-\").concat(publicationMonth || 1, \"-15\");\n                formData.append('publication[publicationDate]', publicationDate);\n              }\n\n              url = inEditMode ? \"/publications/\".concat(currentPublicationId) : '/publications';\n              _context.prev = 11;\n              _context.next = 14;\n              return _regeneratorRuntime.awrap(fetch(url, {\n                method: inEditMode ? 'PATCH' : 'POST',\n                body: formData,\n                headers: {\n                  'Accept': 'application/json',\n                  'X-CSRF-Token': authenticityToken()\n                }\n              }));\n\n            case 14:\n              publicationResponse = _context.sent;\n              _context.next = 17;\n              return _regeneratorRuntime.awrap(publicationResponse.json());\n\n            case 17:\n              responseJson = _context.sent;\n\n              if (responseJson.success) {\n                _context.next = 22;\n                break;\n              }\n\n              _this.setState({\n                publicationModalLoading: false\n              });\n\n              _context.next = 28;\n              break;\n\n            case 22:\n              _context.next = 24;\n              return _regeneratorRuntime.awrap(fetchPublications(currentUserId));\n\n            case 24:\n              _this.setState({\n                publicationModalLoading: false,\n                publicationTitle: '',\n                publicationName: '',\n                publicationAbstract: '',\n                publicationURL: '',\n                publicationMonth: undefined,\n                publicationYear: undefined\n              });\n\n              clearUrl();\n              afterAddAction(responseJson.publication.id);\n              togglePublicationModal(false);\n\n            case 28:\n              _context.next = 33;\n              break;\n\n            case 30:\n              _context.prev = 30;\n              _context.t0 = _context[\"catch\"](11);\n\n              _this.setState({\n                publicationModalLoading: false\n              });\n\n            case 33:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[11, 30]]);\n    };\n\n    _this.handleChange = function (e, attr) {\n      _this.setState(_defineProperty({}, attr, e.target.value));\n    };\n\n    _this.handleTime = function (e, selection, attr) {\n      _this.setState(_defineProperty({}, attr, selection.value));\n    };\n\n    _this.handleDeletePublication = function _callee2() {\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!confirm(\"Are you sure you want to delete that?\")) {\n                _context2.next = 4;\n                break;\n              }\n\n              _context2.next = 3;\n              return _regeneratorRuntime.awrap(fetch(\"/publications/\".concat(_this.props.currentPublicationId), {\n                method: 'DELETE',\n                headers: {\n                  'Accept': 'application/json',\n                  'X-CSRF-Token': authenticityToken()\n                }\n              }));\n\n            case 3:\n              window.location.reload();\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      });\n    };\n\n    _this.state = {\n      publicationModalLoading: false,\n      publicationTitle: props.publicationTitle,\n      publicationName: props.publicationName,\n      publicationAbstract: props.publicationAbstract,\n      publicationURL: props.publicationURL,\n      publicationMonth: props.publicationMonth,\n      publicationYear: props.publicationYear,\n      importingPublication: false\n    };\n    return _this;\n  }\n\n  _createClass(NewPublicationModal, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this$props2 = this.props,\n          currentPublicationId = _this$props2.currentPublicationId,\n          currentUserId = _this$props2.currentUserId,\n          publications = _this$props2.publications,\n          inEditMode = _this$props2.inEditMode,\n          publicationModalOpen = _this$props2.publicationModalOpen;\n\n      if (inEditMode) {\n        // when OPENING modal to edit publication\n        if (prevProps.publicationModalOpen) return; // skip updating state if modal already open\n\n        var publication = _.find(publications, ['id', currentPublicationId]);\n\n        var date = moment.utc(publication.date);\n        this.setState({\n          publicationTitle: publication.title,\n          publicationName: publication.publication_name,\n          publicationAbstract: publication[\"abstract\"],\n          publicationURL: publication.url,\n          publicationMonth: date.format('M'),\n          publicationYear: date.format('YYYY')\n        });\n      } else {\n        // when creating new publication\n        if (prevProps.publicationTitle !== this.props.publicationTitle) {\n          this.setState({\n            publicationTitle: this.props.publicationTitle,\n            publicationName: this.props.publicationName,\n            publicationAbstract: this.props.publicationAbstract,\n            publicationURL: this.props.publicationURL\n          });\n        }\n\n        if (prevProps.publicationYear !== this.props.publicationYear) {\n          this.setState({\n            publicationYear: this.props.publicationYear,\n            publicationMonth: this.props.publicationMonth\n          });\n        }\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props3 = this.props,\n          title = _this$props3.title,\n          publicationModalOpen = _this$props3.publicationModalOpen,\n          togglePublicationModal = _this$props3.togglePublicationModal,\n          clearUrl = _this$props3.clearUrl,\n          inEditMode = _this$props3.inEditMode;\n      var _this$state2 = this.state,\n          publicationModalLoading = _this$state2.publicationModalLoading,\n          publicationTitle = _this$state2.publicationTitle,\n          publicationName = _this$state2.publicationName,\n          publicationAbstract = _this$state2.publicationAbstract,\n          publicationMonth = _this$state2.publicationMonth,\n          publicationYear = _this$state2.publicationYear,\n          publicationURL = _this$state2.publicationURL,\n          importingPublication = _this$state2.importingPublication;\n      var validPublication = publicationTitle && publicationName && publicationAbstract;\n      return React.createElement(Modal, {\n        open: publicationModalOpen,\n        onClose: function onClose() {\n          clearUrl();\n          togglePublicationModal(false);\n        },\n        size: \"small\",\n        closeOnDimmerClick: false,\n        className: css(styles.NewPublicationModal_modal),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301\n        },\n        __self: this\n      }, React.createElement(Modal.Content, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: css(styles.NewPublicationModal_modalHeader),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 312\n        },\n        __self: this\n      }, title), React.createElement(\"div\", {\n        className: css(styles.NewPublicationModal_modalFieldLabel),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 313\n        },\n        __self: this\n      }, \"Journal\"), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        className: css(styles.NewPublicationModal_modalInput),\n        placeholder: \"e.g. Science, American Journal of Kidney Diseases, Journal of Neuroscience\",\n        value: publicationName,\n        type: \"text\",\n        onChange: function onChange(e) {\n          return _this2.handleChange(e, 'publicationName');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 317\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: css(styles.NewPublicationModal_modalFieldLabel),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325\n        },\n        __self: this\n      }, \"Publication Title\"), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        className: css(styles.NewPublicationModal_modalInput),\n        placeholder: \"e.g. Cardiovascular risk in children and adolescents with end stage renal disease\",\n        value: publicationTitle,\n        type: \"text\",\n        onChange: function onChange(e) {\n          return _this2.handleChange(e, 'publicationTitle');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329\n        },\n        __self: this\n      })), publicationURL && React.createElement(React.Fragment, null, React.createElement(\"div\", {\n        className: css(styles.NewPublicationModal_modalFieldLabel),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 339\n        },\n        __self: this\n      }, \"Publication URL\"), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 342\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        className: css(styles.NewPublicationModal_modalInput),\n        value: publicationURL,\n        type: \"text\",\n        disabled: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 343\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: css(styles.NewPublicationModal_modalFieldLabel),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 351\n        },\n        __self: this\n      }, \"Abstract\"), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 354\n        },\n        __self: this\n      }, React.createElement(\"textarea\", {\n        className: css(styles.NewPublicationModal_modalTextArea),\n        rows: \"4\",\n        value: publicationAbstract,\n        onChange: function onChange(e) {\n          return _this2.handleChange(e, 'publicationAbstract');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 355\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: css(styles.NewPublicationModal_modalFieldLabel),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 362\n        },\n        __self: this\n      }, \"Date\"), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 365\n        },\n        __self: this\n      }, React.createElement(Dropdown, {\n        className: css(styles.NewPublicationModal_dateDropdown),\n        icon: \"chevron down\",\n        fluid: true,\n        selection: true,\n        placeholder: \"Month\",\n        style: {\n          marginRight: '4%'\n        },\n        value: publicationMonth || '',\n        options: monthOptions,\n        onChange: function onChange(e, selection) {\n          return _this2.handleTime(e, selection, 'publicationMonth');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 366\n        },\n        __self: this\n      }), React.createElement(Dropdown, {\n        className: css(styles.NewPublicationModal_dateDropdown),\n        icon: \"chevron down\",\n        fluid: true,\n        placeholder: \"Year\",\n        selection: true,\n        value: publicationYear || '',\n        options: yearOptions,\n        onChange: function onChange(e, selection) {\n          return _this2.handleTime(e, selection, 'publicationYear');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 377\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: css(styles.NewPublicationModal_modalButtonHolder),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 388\n        },\n        __self: this\n      }, inEditMode && React.createElement(Button, {\n        className: css(modalStyles.Modal_deleteButton),\n        type: \"submit\",\n        disabled: publicationModalLoading,\n        onClick: this.handleDeletePublication,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 390\n        },\n        __self: this\n      }, \"Delete\"), React.createElement(Button, {\n        className: css(styles.NewPublicationModal_modalCancelButton),\n        type: \"submit\",\n        onClick: function onClick() {\n          clearUrl();\n          togglePublicationModal(false);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 399\n        },\n        __self: this\n      }, \"Cancel\"), React.createElement(Button, {\n        className: css(styles.NewPublicationModal_modalSubmitButton),\n        type: \"submit\",\n        disabled: publicationModalLoading || !validPublication,\n        onClick: this.handleSubmitPublication,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 409\n        },\n        __self: this\n      }, \"Submit\"))));\n    }\n  }]);\n\n  return NewPublicationModal;\n}(PureComponent);\n\nNewPublicationModal.propTypes = {\n  title: PropTypes.string,\n  fetchPublications: PropTypes.func,\n  togglePublicationModal: PropTypes.func,\n  afterAddAction: PropTypes.func\n};\nNewPublicationModal.defaultProps = {\n  afterAddAction: function afterAddAction() {}\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  var _ref;\n\n  return _ref = {\n    publicationModalOpen: state.profiles.publicationModalOpen,\n    currentPublicationId: state.profiles.currentPublicationId,\n    inEditMode: !!state.profiles.currentPublicationId,\n    publications: state.profiles.publications\n  }, _defineProperty(_ref, \"currentPublicationId\", state.profiles.currentPublicationId), _defineProperty(_ref, \"inEditMode\", !!state.profiles.currentPublicationId), _ref;\n};\n\nvar mapDispatchToProps = {\n  fetchPublications: fetchPublicationsAction,\n  togglePublicationModal: togglePublicationModalAction\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(NewPublicationModal);","map":{"version":3,"sources":["/Volumes/Work/work/dev/project/projects/halo/app/javascript/src/marketplace/components/NewPublicationModal/NewPublicationModal.jsx"],"names":["React","PureComponent","PropTypes","connect","css","StyleSheet","Modal","Button","Dropdown","Icon","_","DatePicker","moment","styles","modalStyles","COLORS","fetchPublications","fetchPublicationsAction","togglePublicationModal","togglePublicationModalAction","authenticityToken","create","NewPublicationModal_modal","overflow","NewPublicationModal_dateDropdown","width","height","fontSize","display","alignItems","borderRadius","paddingTop","color","defaultText","border","NewPublicationModal_modalFieldLabel","textAlign","margin","fontWeight","lineHeight","labelGray","NewPublicationModal_modalInput","padding","borderStyle","borderWidth","NewPublicationModal_modalHeader","lightBlack","marginBottom","NewPublicationModal_modalTextArea","NewPublicationModal_datepicker","NewPublicationModal_modalSubmitButton","background","lightBlue","backgroundImage","white","NewPublicationModal_modalButtonHolder","marginTop","NewPublicationModal_modalCancelButton","backgroundColor","yearOptions","range","Date","getFullYear","map","year","key","text","value","String","locale","monthOptions","monthsShort","month","index","NewPublicationModal","props","handleSubmitPublication","e","currentUserId","currentPublicationId","clearUrl","afterAddAction","inEditMode","preventDefault","state","publicationTitle","publicationName","publicationAbstract","publicationMonth","publicationYear","publicationURL","setState","publicationModalLoading","formData","FormData","append","encodeURI","publicationDate","url","fetch","method","body","headers","publicationResponse","json","responseJson","success","undefined","publication","id","handleChange","attr","target","handleTime","selection","handleDeletePublication","confirm","window","location","reload","importingPublication","prevProps","publications","publicationModalOpen","find","date","utc","title","publication_name","format","validPublication","marginRight","Modal_deleteButton","propTypes","string","func","defaultProps","mapStateToProps","profiles","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { css, StyleSheet } from 'aphrodite';\nimport { Modal, Button, Dropdown, Icon } from 'semantic-ui-react';\nimport _ from 'lodash';\nimport DatePicker from 'react-datepicker';\nimport moment from 'moment';\nimport { styles as modalStyles } from '../Modal'\nimport { COLORS } from '../../../../constants';\nimport {\n  fetchPublications as fetchPublicationsAction,\n  togglePublicationModal as togglePublicationModalAction,\n} from '../../actions/profileActions';\nimport {\n  authenticityToken,\n} from '../../utils/requests';\n\n\nconst styles = StyleSheet.create({\n  NewPublicationModal_modal: {\n    overflow: 'visible',\n  },\n  NewPublicationModal_dateDropdown: {\n    width: '48%',\n    height: '48px',\n    fontSize: '14px',\n    display: 'inline-block',\n    alignItems: 'center',\n    borderRadius: '0px',\n    paddingTop: '16px',\n    color: COLORS.defaultText,\n    border: `1px solid ${COLORS.defaultText}`,\n  },\n  NewPublicationModal_modalFieldLabel: {\n    textAlign: 'left',\n    margin: '10px 0 6px',\n    width: '100%',\n    fontSize: '12px',\n    fontWeight: 500,\n    lineHeight: '16px',\n    color: COLORS.labelGray,\n  },\n  NewPublicationModal_modalInput: {\n    width: '100%',\n    margin: 'auto',\n    padding: '10px',\n    height: '50px',\n    fontSize: '14px',\n    lineHeight: '20px',\n    borderStyle: 'solid',\n    borderWidth: '1px',\n  },\n  NewPublicationModal_modalHeader: {\n    fontWeight: 500,\n    fontSize: '24px',\n    lineHeight: '32px',\n    color: COLORS.lightBlack,\n    marginBottom: '32px',\n  },\n  NewPublicationModal_modalTextArea: {\n    width: '100%',\n    margin: 'auto',\n    padding: '10px',\n    fontSize: '14px',\n    lineHeight: '20px',\n  },\n  NewPublicationModal_datepicker: {\n    width: '100%',\n    height: '50px',\n    padding: '10px',\n    borderStyle: 'solid',\n    borderWidth: '1px',\n    fontSize: '14px',\n  },\n  NewPublicationModal_modalSubmitButton: {\n    background: COLORS.lightBlue,\n    backgroundImage: 'linear-gradient(134.72deg, #4E9DF5 0%, #48B2F4 100%)',\n    display: 'inline-block',\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.white,\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px',\n  },\n  NewPublicationModal_modalButtonHolder: {\n    width: '100%',\n    display: 'inline-block',\n    textAlign: 'right',\n    marginTop: '36px',\n  },\n  NewPublicationModal_modalCancelButton: {\n    height: '48px',\n    textAlign: 'center',\n    color: COLORS.lightBlack,\n    backgroundColor: COLORS.white,\n    display: 'inline-block',\n    fontSize: '14px',\n    fontWeight: 500,\n    lineHeight: '20px',\n    padding: '5px 50px',\n  },\n});\n\nconst yearOptions = _.range(new Date().getFullYear(), 1950, -1).map((year) => {\n  return {\n    key: year,\n    text: year,\n    value: String(year),\n  };\n});\n\nmoment.locale('en');\nconst monthOptions = moment.monthsShort('-MMM-').map((month, index) => {\n  return {\n    key: month,\n    text: month,\n    value: String(index + 1),\n  };\n});\n\nclass NewPublicationModal extends PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      publicationModalLoading: false,\n      publicationTitle: props.publicationTitle,\n      publicationName: props.publicationName,\n      publicationAbstract: props.publicationAbstract,\n      publicationURL: props.publicationURL,\n      publicationMonth: props.publicationMonth,\n      publicationYear: props.publicationYear,\n      importingPublication: false,\n    };\n  }\n\n  componentDidUpdate(prevProps) {\n    const {\n      currentPublicationId,\n      currentUserId,\n      publications,\n      inEditMode,\n      publicationModalOpen\n    } = this.props;\n\n    if(inEditMode){\n      // when OPENING modal to edit publication\n\n      if (prevProps.publicationModalOpen) return;\n      // skip updating state if modal already open\n\n      const publication = _.find(publications, ['id', currentPublicationId])\n      const date = moment.utc(publication.date);\n\n      this.setState({\n        publicationTitle: publication.title,\n        publicationName: publication.publication_name,\n        publicationAbstract: publication.abstract,\n        publicationURL: publication.url,\n        publicationMonth: date.format('M'),\n        publicationYear: date.format('YYYY'),\n      });\n    } else {\n      // when creating new publication\n      if (prevProps.publicationTitle !== this.props.publicationTitle) {\n        this.setState({\n          publicationTitle: this.props.publicationTitle,\n          publicationName: this.props.publicationName,\n          publicationAbstract: this.props.publicationAbstract,\n          publicationURL: this.props.publicationURL,\n        });\n      }\n      if (prevProps.publicationYear !== this.props.publicationYear) {\n        this.setState({\n          publicationYear: this.props.publicationYear,\n          publicationMonth: this.props.publicationMonth,\n        });\n      }\n    }\n  }\n\n  handleSubmitPublication = async (e) => {\n    const {\n      fetchPublications,\n      togglePublicationModal,\n      currentUserId,\n      currentPublicationId,\n      clearUrl,\n      afterAddAction,\n      inEditMode\n    } = this.props;\n\n    e.preventDefault();\n\n    const {\n      publicationTitle,\n      publicationName,\n      publicationAbstract,\n      publicationMonth,\n      publicationYear,\n      publicationURL,\n    } = this.state;\n\n    this.setState({\n      publicationModalLoading: true,\n    });\n\n    const formData = new FormData();\n    formData.append('publication[publicationTitle]', publicationTitle);\n    formData.append('publication[publicationName]', publicationName);\n    formData.append('publication[publicationAbstract]', publicationAbstract);\n    formData.append('publication[publicationURL]', encodeURI(publicationURL));\n\n    if (publicationYear) {\n      const publicationDate = `${publicationYear}-${publicationMonth || 1}-15`;\n      formData.append('publication[publicationDate]', publicationDate);\n    }\n\n    const url = (inEditMode ? `/publications/${currentPublicationId}` : '/publications')\n\n    try {\n      const publicationResponse = await fetch(url, {\n        method: (inEditMode ? 'PATCH' : 'POST'),\n        body: formData,\n        headers: {\n          'Accept': 'application/json',\n          'X-CSRF-Token': authenticityToken(),\n        }\n      });\n      const responseJson = await publicationResponse.json();\n      if (!responseJson.success) {\n        this.setState({\n          publicationModalLoading: false,\n        });\n      } else {\n        await fetchPublications(currentUserId);\n        this.setState({\n          publicationModalLoading: false,\n          publicationTitle: '',\n          publicationName: '',\n          publicationAbstract: '',\n          publicationURL: '',\n          publicationMonth: undefined,\n          publicationYear: undefined,\n        });\n        clearUrl();\n        afterAddAction(responseJson.publication.id);\n        togglePublicationModal(false);\n      }\n    } catch(err) {\n      this.setState({ publicationModalLoading: false });\n    }\n  }\n\n  handleChange = (e, attr) => {\n    this.setState({ [attr]: e.target.value });\n  };\n\n  handleTime = (e, selection, attr) => {\n    this.setState({ [attr]: selection.value });\n  };\n\n  handleDeletePublication = async () => {\n    if (confirm(\"Are you sure you want to delete that?\")) {\n      await fetch(`/publications/${this.props.currentPublicationId}`, {\n        method: 'DELETE',\n        headers: {\n          'Accept': 'application/json',\n          'X-CSRF-Token': authenticityToken(),\n        }\n      });\n      window.location.reload();\n    }\n  }\n\n  render() {\n    const {\n      title,\n      publicationModalOpen,\n      togglePublicationModal,\n      clearUrl,\n      inEditMode\n    } = this.props;\n\n    const {\n      publicationModalLoading,\n      publicationTitle,\n      publicationName,\n      publicationAbstract,\n      publicationMonth,\n      publicationYear,\n      publicationURL,\n      importingPublication,\n    } = this.state;\n\n    const validPublication = publicationTitle && publicationName && publicationAbstract;\n    return (\n      <Modal\n        open={publicationModalOpen}\n        onClose={() => {\n          clearUrl();\n          togglePublicationModal(false);\n        }}\n        size=\"small\"\n        closeOnDimmerClick={false}\n        className={css(styles.NewPublicationModal_modal)}\n      >\n        <Modal.Content>\n          <div className={css(styles.NewPublicationModal_modalHeader)}>{title}</div>\n          <div className={css(styles.NewPublicationModal_modalFieldLabel)}>\n            Journal\n          </div>\n          <div>\n            <input\n              className={css(styles.NewPublicationModal_modalInput)}\n              placeholder='e.g. Science, American Journal of Kidney Diseases, Journal of Neuroscience'\n              value={publicationName}\n              type='text'\n              onChange={(e) => this.handleChange(e, 'publicationName')}\n            />\n          </div>\n          <div className={css(styles.NewPublicationModal_modalFieldLabel)}>\n            Publication Title\n          </div>\n          <div>\n            <input\n              className={css(styles.NewPublicationModal_modalInput)}\n              placeholder='e.g. Cardiovascular risk in children and adolescents with end stage renal disease'\n              value={publicationTitle}\n              type='text'\n              onChange={(e) => this.handleChange(e, 'publicationTitle')}\n            />\n          </div>\n          {publicationURL &&\n            <>\n              <div className={css(styles.NewPublicationModal_modalFieldLabel)}>\n                Publication URL\n              </div>\n              <div>\n                <input\n                  className={css(styles.NewPublicationModal_modalInput)}\n                  value={publicationURL}\n                  type='text'\n                  disabled={true}\n                />\n              </div>\n            </>}\n          <div className={css(styles.NewPublicationModal_modalFieldLabel)}>\n            Abstract\n          </div>\n          <div>\n            <textarea\n              className={css(styles.NewPublicationModal_modalTextArea)}\n              rows=\"4\"\n              value={publicationAbstract}\n              onChange={(e) => this.handleChange(e, 'publicationAbstract')}\n            />\n          </div>\n          <div className={css(styles.NewPublicationModal_modalFieldLabel)}>\n            Date\n          </div>\n          <div>\n            <Dropdown\n              className={css(styles.NewPublicationModal_dateDropdown)}\n              icon='chevron down'\n              fluid\n              selection\n              placeholder=\"Month\"\n              style={{ marginRight: '4%' }}\n              value={publicationMonth || ''}\n              options={monthOptions}\n              onChange={(e, selection) => this.handleTime(e, selection, 'publicationMonth')}\n            />\n            <Dropdown\n              className={css(styles.NewPublicationModal_dateDropdown)}\n              icon='chevron down'\n              fluid\n              placeholder=\"Year\"\n              selection\n              value={publicationYear || ''}\n              options={yearOptions}\n              onChange={(e, selection) => this.handleTime(e, selection, 'publicationYear')}\n            />\n          </div>\n          <div className={css(styles.NewPublicationModal_modalButtonHolder)}>\n            {inEditMode &&\n              <Button\n                className={css(modalStyles.Modal_deleteButton)}\n                type='submit'\n                disabled={publicationModalLoading}\n                onClick={this.handleDeletePublication}\n                >\n                Delete\n              </Button>\n            }\n            <Button\n              className={css(styles.NewPublicationModal_modalCancelButton)}\n              type='submit'\n              onClick={() => {\n                clearUrl();\n                togglePublicationModal(false);\n              }}\n            >\n              Cancel\n            </Button>\n            <Button\n              className={css(styles.NewPublicationModal_modalSubmitButton)}\n              type='submit'\n              disabled={publicationModalLoading || !validPublication}\n              onClick={this.handleSubmitPublication}\n            >\n              Submit\n            </Button>\n          </div>\n        </Modal.Content>\n      </Modal>\n    );\n  }\n}\n\nNewPublicationModal.propTypes = {\n  title: PropTypes.string,\n  fetchPublications: PropTypes.func,\n  togglePublicationModal: PropTypes.func,\n  afterAddAction: PropTypes.func,\n};\n\nNewPublicationModal.defaultProps = {\n  afterAddAction: () => {},\n};\n\nconst mapStateToProps = (state) => {\n  return {\n    publicationModalOpen: state.profiles.publicationModalOpen,\n    currentPublicationId: state.profiles.currentPublicationId,\n    inEditMode: !!state.profiles.currentPublicationId,\n    publications: state.profiles.publications,\n    currentPublicationId: state.profiles.currentPublicationId,\n    inEditMode: !!state.profiles.currentPublicationId\n  };\n};\n\nconst mapDispatchToProps = {\n  fetchPublications: fetchPublicationsAction,\n  togglePublicationModal: togglePublicationModalAction,\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(NewPublicationModal);\n"]},"metadata":{},"sourceType":"module"}